{% comment %}
  Renders a sticky product form that appears at the bottom of the page

  Accepts:
  - product: {Object} Product Liquid object

  Usage:
  {% render 'product-sticky-form', product: product %}
{% endcomment %}

{{ 'product-sticky-form.css' | asset_url | stylesheet_tag }}
<script src='{{ 'product-sticky-form.js' | asset_url }}' defer='defer'></script>

<sticky-product-form>
  <div class='product--sticky-form quick-add-hidden'>
    <div class='sticky-form-content page-width'>
      <!-- Product Info -->
      <div class='product-info'>
        {% if product.featured_media %}
          <img
            src='{{ product.featured_media | image_url: width: 96 }}'
            alt='{{ product.featured_media.alt | escape }}'
            class='product-image'
            width='48'
            height='48'
          >
        {% endif %}

        <div class='product-details'>
          <h3 class='product-title'>{{ product.title }}</h3>
          <div class='product-price'>
            {%- render 'price', product: product, price_class: '', show_badges: false -%}
          </div>
        </div>
      </div>

      <!-- Product Form -->
      <product-form class='product-form' data-hide-errors='false' data-section-id='{{ section.id }}'>
        <div class='product-form__error-message-wrapper' role='alert' hidden>
          <svg
            aria-hidden='true'
            focusable='false'
            class='icon icon-error'
            viewBox='0 0 13 13'
          >
            <circle cx="6.5" cy="6.5" r="5.5" stroke="white" stroke-width="2"/>
            <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
            <path d="m5.8 3.6h1.4L7 8.5H6.4L5.8 3.6Z" fill="white"/>
            <path d="m5.8 8.5h1.5v1.4H5.8Z" fill="white"/>
          </svg>
          <span class='product-form__error-message'></span>
        </div>

        <form
          action='{{ routes.cart_add_url }}'
          method='post'
          enctype='multipart/form-data'
          novalidate='novalidate'
          data-type='add-to-cart-form'
        >
          <input type='hidden' name='id' value='{{ product.selected_or_first_available_variant.id }}'>

          <!-- Variant Selection -->
          {% unless product.has_only_default_variant %}
            <variant-selects
              id='variant-selects-sticky-{{ section.id }}'
              class='no-js-hidden'
              data-section='{{ section.id }}'
              data-url='{{ product.url }}'
              {{ block.shopify_attributes }}
            >
              {% for option in product.options_with_values %}
                <div class='product-form__input product-form__input--dropdown'>
                  <label class='form__label' for='Option-sticky-{{ section.id }}-{{ forloop.index0 }}'>
                    {{ option.name }}
                  </label>
                  <div class='select'>
                    <select
                      id='Option-sticky-{{ section.id }}-{{ forloop.index0 }}'
                      class='select__select'
                      name='options[{{ option.name | escape }}]'
                    >
                      {% for value in option.values %}
                        <option
                          value='{{ value | escape }}'
                          {% if option.selected_value == value %}
                            selected='selected'
                          {% endif %}
                          {% unless value.available %}
                            disabled
                          {% endunless %}
                        >
                          {{ value }}
                        </option>
                      {% endfor %}
                    </select>
                    <span>{{ 'icon-caret' | inline_asset_content }}</span>
                  </div>
                </div>
              {% endfor %}

              <script type='application/json'>
                {{ product.variants | json }}
              </script>
            </variant-selects>
          {% endunless %}

          <!-- Quantity (hidden, defaults to 1) -->
          <input type='hidden' name='quantity' value='1'>

          <!-- Add to Cart Button -->
          <button
            type='submit'
            name='add'
            class='product-form__submit button button--full-width button--primary'
            {% if product.selected_or_first_available_variant.available == false %}
              disabled
            {% endif %}
          >
            <span>
              {%- if product.selected_or_first_available_variant.available -%}
                {{ 'products.product.add_to_cart' | t }}
              {%- else -%}
                {{ 'products.product.sold_out' | t }}
              {%- endif -%}
            </span>
            {%- render 'loading-spinner' -%}
          </button>
        </form>
      </product-form>
    </div>
  </div>
</sticky-product-form>
