{% comment %}
  <script>
  window.needToInjectNvd = true;
  const injectNvdToCart = () => {
    const parent = document.querySelector('.rebuy-cart__flyout-footer');
    const nvdContainer = document.querySelector('.rebuy-cart__flyout-actions');

    if (!nvdContainer) return;

    const nvdDiv = document.createElement('div');
    nvdDiv.setAttribute('class', 'nvd-mini w-nvd-100');

    if (parent && !parent.innerHTML.includes('nvd-mini')) {
      nvdContainer.parentNode.insertBefore(nvdDiv, nvdContainer);
    }
  };

  window.addEventListener('click', (ev) => {
    setTimeout(injectNvdToCart, 500);
  }, true);

  </script>
{% endcomment %}
<style>
  div#nvd-standard-widget-container {
    /* max-width: unset !important; */
  }
</style>

<!-- navidium script start -->
<script>
  const nvdShop = 'alex-crane-store.myshopify.com';
  const nvdShopCurrency = '{{ shop.money_format | strip_html }}';
  const nvdControls = {
    subtotal_item: '.rebuy-cart__flyout-subtotal-amount,section.order-subtotal span',
    CheckoutBtns: '.rebuy-checkout,.rebuy-checkout *,[name="checkout"],[name="checkout"] *',
    clickTriggers:
      '[name="add"],[name="add"] *,[href="/cart"],[href="/cart"] *,.rebuy-button,.rebuy-button *,.rebuy-cart__flyout-item-quantity-widget-button,.rebuy-cart__flyout-item-quantity-widget-button *,.rebuy-cart__flyout-item-remove,.rebuy-cart__flyout-item-remove *,.remove,.remove *',
    changeTrigger: '.rebuy-cart__flyout-item-quantity-widget-button',
    cursorControl: '.nvd-mini',
    showConsoleMessage: false,
    iosDeviceListener: 'click',
    trackWidget: false,
    forceClick: true,
    forceCheckout: true,
    redirectCheckout: {
      upsaleOff: true,
      noProtection: false,
    },
  };
</script>
<!-- <script  src="https://d10pwglna6up6p.cloudfront.net/navidium-widgets/js/nvd-js-asset.js"></script> -->
<script src='https://d10pwglna6up6p.cloudfront.net/navidium-widgets/js/nvd-widget-v-jquery.js' defer></script>
<!-- navidium script end -->
<style>
  .d-flexCstm-ld {
    /* max-width: 100% !important; */
    width: 100%;
    margin: 0 auto;
  }

  div#nvd-widget-cart {
    width: 100%;
  }

  div#nvd-widget-cart {
    margin-top: 0;
  }

  .d-flexCstm-ld {
    margin-bottom: 0 !important;
  }
  .d-flexCstm-ld {
    gap: 14px;
  }
  .rebuy-cart__flyout-integration .nvd-mini:nth-child(2) {
    display: none;
  }
</style>

<script>
  const injectNvdToRebuy = () => {
    if (document?.querySelector('.rebuy-cart__flyout-integration .nvd-mini')) return;
    const parent = document?.querySelector('.rebuy-cart__flyout-integration');
    const nvdDiv = document.createElement('div');
    nvdDiv.setAttribute('class', 'nvd-mini');
    if (!parent?.innerHTML.includes('nvd-mini')) {
      parent.appendChild(nvdDiv);
    }
  };

  const observeCartChanges = () => {
    const targetNode = document.body;

    const config = { childList: true, subtree: true };

    const callback = (mutationsList) => {
      for (const mutation of mutationsList) {
        if (mutation.type === 'childList') {
          // Replace with target element (rebuy/dynamatic/upcart or others)
          if (document.querySelector('.rebuy-cart__flyout-integration')) {
            injectNvdToRebuy();
          }
        }
      }
    };

    const observer = new MutationObserver(callback);
    observer.observe(targetNode, config);
  };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', observeCartChanges);
  } else {
    observeCartChanges();
  }

  document.addEventListener('rebuy:smartcart.ready', (event) => {
    setTimeout(nvd_init, 300);
  });
  document.addEventListener('rebuy:smartcart.show', (event) => {
    setTimeout(nvd_init, 300);
  });
  document.addEventListener('rebuy:cart.change', (event) => {
    setTimeout(nvd_init, 300);
  });
  document.addEventListener('rebuy:cart.add', (event) => {
    setTimeout(nvd_init, 300);
  });
</script>
