{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'section-related-products.css' | asset_url | stylesheet_tag }}

{% if section.settings.image_shape == 'blob' %}
  {{ 'mask-blobs.css' | asset_url | stylesheet_tag }}
{%- endif -%}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}
<!-- Widget : Product Recommendations -->
<div data-rebuy-id='232526' data-rebuy-shopify-product-ids='{{ product.id }}'></div>
{% raw %}
	<script id='rebuy-widget-232526' data-rebuy-shopify-product-ids='{{ product.id }}' type="text/template">
		<div class="rebuy-widget" v-cloak v-on:click="stopPropagation($event)" v-bind:id="'rebuy-widget-' + id"
			v-bind:class="['widget-type-' + config.type.replace('_','-'), 'widget-display-' + config.display_type, products.length > 0 ? 'is-visible' : 'is-hidden']">
			<div class="rebuy-widget-container" v-cloak
				v-bind:class="['widget-display-' + config.display_type, visible ? 'is-visible' : 'is-hidden' ]"
				v-on:click.self="hide()">
				<div class="rebuy-widget-content">
					<div class="rebuy-modal-close" v-on:click="hide()"> <i class="fas fa-times"></i> </div>
					<h4 class="super-title" v-if="config.language.super_title != ''" v-html="config.language.super_title"></h4>
					<h3 class="primary-title" v-if="config.language.title != ''" v-html="config.language.title"></h3>
					<div class="description" v-if="config.language.description != ''" v-html="config.language.description"></div>
					<div class="rebuy-product-grid" v-bind:class="layoutClasses">
						<div class="rebuy-product-block" v-for="(product, product_index) in products"
							v-bind:class="[product.handle, 'product-id-' + product.id, cartHasProduct(product) ? 'cart-has-item' : '', productTagClasses(product)]">
							<div class="rebuy-product-media"> 
								<a class="rebuy-product-image en-gb" 
									v-if="Shopify.country === 'GB'"
									v-bind:href="learnMoreURL(product).replace(/^/,'/en-gb').replace('/en-gb/en-gb','/en-gb')"
									v-bind:style="imageStyles" 
									v-bind:class="[hasLearnMore() ? 'clickable' : '']"> 
									<img v-bind:src="itemImage(product, product.selected_variant, '900x')"
										v-bind:alt="'View ' + product.title">
								</a>
								<a class="rebuy-product-image en-ca" 
									v-else-if="Shopify.country === 'CA'"
									v-bind:href="learnMoreURL(product).replace(/^/,'/en-ca').replace('/en-ca/en-ca','/en-ca')"
									v-bind:style="imageStyles" 
									v-bind:class="[hasLearnMore() ? 'clickable' : '']"> 
									<img v-bind:src="itemImage(product, product.selected_variant, '900x')"
										v-bind:alt="'View ' + product.title">
								</a>
								<a class="rebuy-product-image en-us" 
									v-else
									v-bind:href="learnMoreURL(product)" 
									v-bind:style="imageStyles"
									v-on:click="learnMore(product);"
									v-bind:class="[hasLearnMore() ? 'clickable' : '']">
									<img
										v-bind:src="itemImage(product, product.selected_variant, '900x')"
										v-bind:alt="'View ' + product.title"> 
								</a> 
							</div>
							<div class="rebuy-product-info"> 
								<a class="rebuy-product-title" 
									v-if="Shopify.country === 'GB'"
									v-bind:href="learnMoreURL(product).replace(/^/,'/en-gb').replace('/en-gb/en-gb','/en-gb')"
									v-html="product.title"
									v-bind:class="[hasLearnMore() ? 'clickable gb' : '']"
									v-bind:alt="'View ' + product.title"></a>
								<a class="rebuy-product-title" 
									v-if="Shopify.country === 'CA'"
									v-bind:href="learnMoreURL(product).replace(/^/,'/en-ca').replace('/en-ca/en-ca','/en-ca')"
									v-html="product.title"
									v-bind:class="[hasLearnMore() ? 'clickable ca' : '']"
									v-bind:alt="'View ' + product.title"></a>
								<a class="rebuy-product-title" 
									v-if="Shopify.country !== 'GB' && Shopify.country !== 'CA'"
									v-bind:href="learnMoreURL(product)"
									v-on:click="learnMore(product);" 
									v-html="product.title"
									v-bind:class="[hasLearnMore() ? 'clickable us' : '']"
									v-bind:alt="'View ' + product.title"></a>
								<div class="rebuy-variant-title" v-if="showVariantTitle(product)" v-html="product.selected_variant.title">
								</div>
								<div class="rebuy-product-review" v-if="hasProductReviews(product)"> <span class="rebuy-star-rating"> <span
											class="rebuy-star-rating-background"></span> <span class="rebuy-star-rating-foreground"
											v-bind:style="{ width: productReviewRatingPercentage(product) }"></span> </span> <span
										class="rebuy-review-count" v-html="productReviewCount(product)"></span> </div>
								<div class="rebuy-product-price">
									<div v-if="variantOnSale(product, product.selected_variant)"> 
										<span 
											v-bind:class="[Shopify.country !== 'US' ? 'xx rebuy-money sale localize-sale-price' : 'xx rebuy-money sale']"
											v-html="formatMoney(variantPrice(product, product.selected_variant))"></span>
										<span 
											class="localize-compare-price"
											v-html="formatMoney(variantCompareAtPrice(product, product.selected_variant))"></span> 
									</div>
									<div v-if="!(variantOnSale(product, product.selected_variant))"> 
									<span
										v-bind:class="[Shopify.country !== 'US' ? 'zz rebuy-money localize-price' : 'zz rebuy-money']"
										v-html="formatMoney(variantPrice(product, product.selected_variant))"></span> 
									</div>
								</div>
								<div class="rebuy-product-description" v-if="showProductDescription(product)"
									v-html="text(product.body_html)"></div>
							</div>
							<div class="rebuy-product-options" v-if="showVariantSelect(product)"> <select
									:id="id + '-' + 'select' + '-' + product_index"
									:class="{ hide : settings.view_options.variant_selector == 'buttons' }" class="rebuy-select"
									v-model="product.selected_variant_id" v-on:change="selectVariant(product)">
									<option v-for="variant in product.variants" v-bind:value="variant.id">{{ variant.title }}</option>
								</select>
								<div v-if="option.name == 'Color' && displayColorSwatches()"
									v-for="(option, option_index) in product.options" class="rebuy-color-swatches">
									<div v-for="(value, value_index) in option.values" class="rebuy-color-swatch"> <input
											:name="id + '-color-' + product_index"
											:id="id + '-color-' + option_index + '-' + value + '-' + value_index" :checked="value_index == 0" 
											:value="value" type="radio" class="rebuy-color-input hide"
											v-on:change="selectVariantByColor(product, value, product_index)"> <label
											:for="id + '-color-' + option_index + '-' + value + '-' + value_index"
											:style="{ backgroundColor: value }" :title="value" class="rebuy-color-label"></label> </div>
								</div>
								<div v-if="option.name == 'Size' && settings.view_options.variant_selector == 'buttons'"
									v-for="(option, option_index) in product.options" class="mt-10 rebuy-size-swatches">
									<div v-for="(value, value_index) in option.values" class="rebuy-size-swatch"> <input
											:name="id + '-size-' + product_index" :id="id + '-size-' + product_index + '-' + value"
											:checked="value_index == 0" :value="value" type="radio" class="rebuy-size-input hide"
											v-on:change="selectVariantBySize(product, value, product_index)"> <label
											:for="id + '-size-' + product_index + '-' + value" class="rebuy-size-label">{{ value }}</label> </div>
								</div>
							</div>
							<div class="rebuy-product-actions"
								v-if="settings && settings.view_options && settings.view_options.display_actions">
								<div class="subscription-checkbox" v-if="showSubscriptionOptions(product)"> <label
										class="rebuy-checkbox-label"> <input class="checkbox-input rebuy-checkbox"
											v-model="product.subscription" v-on:change="toggleSubscription(product)" type="checkbox" /> <span
											class="checkbox-label" v-html="upgradeToSubscriptionLabel(product)"></span> </label> </div>
								<div class="subscription-frequency" v-if="showSubscriptionFrequency(product)"> <select class="rebuy-select"
										v-model="product.subscription_frequency" v-on:change="updateSubscriptionFrequency(product)">
										<option v-for="frequency in product.subscription_frequencies" v-bind:value="frequency">
											{{ frequencyLabel(frequency, product.subscription_interval) }}</option>
									</select> </div>
								<div class="product-quantity" v-if="hasQuantityInputEnabled()">
									<div class="rebuy-select-wrapper"> <label class="rebuy-label">Quantity</label> <select
											class="rebuy-select" v-model="product.quantity">
											<option v-for="n in maxQuantityInputValue()" v-bind:value="n">{{ n }}</option>
										</select> </div>
								</div> <button class="rebuy-button"
									v-bind:class="{ working: (product.status != 'ready' && product.status != 'selecting') }"
									v-bind:alt="'Add ' + product.title + ' to Cart'"
									v-bind:disabled="!(variantAvailable(product.selected_variant)) || (product.status != 'ready' && product.status != 'selecting')"
									v-on:click="addToCart(product)" type="button"> <span v-html="buttonLabel(product)"></span> </button>
							</div>
						</div>
					</div>
					<div class="rebuy-modal-actions" v-if="showContinueButton()"> <button class="rebuy-button decline"
							v-on:click="hide()" type="button"> <span v-html="continueLabel()"></span> </button> </div>
				</div>
			</div>
		</div>
	</script>
{% endraw %}
<!-- End Widget : Product Recommendations -->

<div class='color-{{ section.settings.color_scheme }} gradient'>
  <product-recommendations
    class='related-products page-width section-{{ section.id }}-padding isolate{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}'
    data-url='{{ routes.product_recommendations_url }}?limit={{ section.settings.products_to_show }}'
    data-section-id='{{ section.id }}'
    data-product-id='{{ product.id }}'
  >
    <h2 class='tw-text-[12px] tw-leading-[15px] lg:tw-text-[14px] lg:tw-leading-[17px] tw-font-normal tw-text-[#000] inline-richtext tw-mb-4 lg:tw-mb-8'>
      {{ section.settings.heading }}
    </h2>

    {% comment %}
      <div id='recs1'><!-- Results from graphene will be placed here --></div>
      <div id='recs2'><!-- Results from graphene will be placed here --></div>

      <script>
        $g.load({
          page_context: { product_id: '{{product.id}}' },
          elements: [{ id: 'pdp_recs_1', target: '#recs1' }],
        });
      </script>
    {% endcomment %}

    {% comment %}
      {% if recommendations.performed and recommendations.products_count > 0 %}
        <h2 class='tw-text-[12px] tw-leading-[15px] lg:tw-text-[14px] lg:tw-leading-[17px] tw-font-normal tw-text-[#000] inline-richtext tw-mb-4 lg:tw-mb-8'>
          {{ section.settings.heading }}
        </h2>
        <ul
          class='grid product-grid grid--{{ section.settings.columns_desktop }}-col-desktop grid--{{ section.settings.columns_mobile }}-col-tablet-down'
          role='list'
        >
          {% assign skip_card_product_styles = false %}
          {% for recommendation in recommendations.products %}
            <li class='grid__item'>
              {% render 'card-product',
                card_product: recommendation,
                media_aspect_ratio: section.settings.image_ratio,
                image_shape: section.settings.image_shape,
                show_secondary_image: section.settings.show_secondary_image,
                show_vendor: section.settings.show_vendor,
                show_rating: section.settings.show_rating,
                skip_styles: skip_card_product_styles
              %}
            </li>
            {%- assign skip_card_product_styles = true -%}
          {% endfor %}
        </ul>
      {% endif %}
    {% endcomment %}
  </product-recommendations>
  {% if section.settings.image_shape == 'arch' %}
    {{ 'mask-arch.svg' | inline_asset_content }}
  {%- endif -%}
</div>

{% schema %}
{
  "name": "t:sections.related-products.name",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "paragraph",
      "content": "t:sections.related-products.settings.paragraph__1.content"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "t:sections.related-products.settings.paragraph__1.default",
      "label": "t:sections.related-products.settings.heading.label"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "t:sections.all.heading_size.options__1.label"
        },
        {
          "value": "h1",
          "label": "t:sections.all.heading_size.options__2.label"
        },
        {
          "value": "h0",
          "label": "t:sections.all.heading_size.options__3.label"
        },
        {
          "value": "hxl",
          "label": "t:sections.all.heading_size.options__4.label"
        },
        {
          "value": "hxxl",
          "label": "t:sections.all.heading_size.options__5.label"
        }
      ],
      "default": "h1",
      "label": "t:sections.all.heading_size.label"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 24,
      "step": 1,
      "default": 4,
      "label": "t:sections.related-products.settings.products_to_show.label"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 4,
      "label": "t:sections.related-products.settings.columns_desktop.label"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "info": "t:sections.all.colors.has_cards_info",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.related-products.settings.header__2.content"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "t:sections.related-products.settings.image_ratio.options__1.label"
        },
        {
          "value": "portrait",
          "label": "t:sections.related-products.settings.image_ratio.options__2.label"
        },
        {
          "value": "square",
          "label": "t:sections.related-products.settings.image_ratio.options__3.label"
        }
      ],
      "default": "adapt",
      "label": "t:sections.related-products.settings.image_ratio.label"
    },
    {
      "type": "select",
      "id": "image_shape",
      "options": [
        {
          "value": "default",
          "label": "t:sections.all.image_shape.options__1.label"
        },
        {
          "value": "arch",
          "label": "t:sections.all.image_shape.options__2.label"
        },
        {
          "value": "blob",
          "label": "t:sections.all.image_shape.options__3.label"
        },
        {
          "value": "chevronleft",
          "label": "t:sections.all.image_shape.options__4.label"
        },
        {
          "value": "chevronright",
          "label": "t:sections.all.image_shape.options__5.label"
        },
        {
          "value": "diamond",
          "label": "t:sections.all.image_shape.options__6.label"
        },
        {
          "value": "parallelogram",
          "label": "t:sections.all.image_shape.options__7.label"
        },
        {
          "value": "round",
          "label": "t:sections.all.image_shape.options__8.label"
        }
      ],
      "default": "default",
      "label": "t:sections.all.image_shape.label",
      "info": "t:sections.all.image_shape.info"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "default": false,
      "label": "t:sections.related-products.settings.show_secondary_image.label"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "t:sections.related-products.settings.show_vendor.label"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "default": false,
      "label": "t:sections.related-products.settings.show_rating.label",
      "info": "t:sections.related-products.settings.show_rating.info"
    },
    {
      "type": "header",
      "content": "t:sections.related-products.settings.header_mobile.content"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "default": "2",
      "label": "t:sections.related-products.settings.columns_mobile.label",
      "options": [
        {
          "value": "1",
          "label": "t:sections.related-products.settings.columns_mobile.options__1.label"
        },
        {
          "value": "2",
          "label": "t:sections.related-products.settings.columns_mobile.options__2.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ]
}
{% endschema %}
